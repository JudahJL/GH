{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AI Waste Monitoring & Hotspot Intelligence System</title>
    <meta name="description" content="Real-time detection, prioritization, and spatial intelligence for urban waste management." />

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="{% static 'css/index-fDBeApx4.css' %}">

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>

    <script src="https://cdn.tailwindcss.com"></script>

    <style>
      /* Ensure maps have a height so they render */
      .map-container {
        height: 100%;
        min-height: 350px;
        width: 100%;
        border-radius: 0.5rem;
        z-index: 1;
      }
      /* Hide Lovable badge */
      #lovable-badge { display: none !important; }

      /* Utilities */
      #drop-zone { cursor: pointer; }
      #drop-zone:hover { background-color: hsl(var(--muted)); }

      /* Custom Colors from your snippet */
      .text-severity-high { color: #ef4444; }
      .bg-severity-high { background-color: #ef4444; }
      .bg-confidence { background-color: #22c55e; } /* Green for high confidence */
    </style>
  </head>

  <body>
    <div id="root">
      <div class="min-h-screen bg-background flex flex-col">
        <header class="bg-primary text-primary-foreground">
          <div class="px-6 py-4">
            <div class="flex items-start justify-between">
              <div class="flex items-start gap-4">
                <div class="flex h-12 w-12 items-center justify-center rounded bg-primary-foreground/10">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-map-pin h-6 w-6">
                    <path d="M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0"></path>
                    <circle cx="12" cy="10" r="3"></circle>
                  </svg>
                </div>
                <div>
                  <h1 class="text-xl font-semibold tracking-tight text-primary-foreground">AI Waste Monitoring &amp; Hotspot Intelligence System</h1>
                  <p class="mt-1 text-sm text-primary-foreground/80">Real-time detection, prioritization, and spatial intelligence for urban waste management</p>
                </div>
              </div>
              <div class="flex items-center gap-4 text-sm text-primary-foreground/80">
                <div class="flex items-center gap-2">
                  <span class="relative flex h-3 w-3">
                    <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span>
                    <span class="relative inline-flex rounded-full h-3 w-3 bg-green-500"></span>
                  </span>
                  <span>System Active</span>
                </div>
                <div class="border-l border-primary-foreground/20 pl-4" id="current-time">Loading...</div>
              </div>
            </div>
          </div>
        </header>

        <div class="flex-1 p-4 lg:p-6">
          <div class="grid grid-cols-1 lg:grid-cols-12 gap-4 lg:gap-6 h-full">

            <div class="lg:col-span-3">
              <div class="panel h-full flex flex-col bg-card text-card-foreground rounded-lg border shadow-sm">
                <div class="panel-header p-6 pb-2">
                  <h2 class="text-sm font-semibold">Incident Intake</h2>
                </div>
                <div class="panel-content flex-1 flex flex-col gap-4 p-6 pt-0">
                  <div id="drop-zone" class="relative flex flex-col items-center justify-center rounded-md border-2 border-dashed p-6 transition-colors border-border bg-muted/30 min-h-[160px]">
                    <div id="upload-placeholder" class="text-center">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-upload h-8 w-8 text-muted-foreground mb-2 mx-auto">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="17 8 12 3 7 8"></polyline>
                        <line x1="12" x2="12" y1="3" y2="15"></line>
                        </svg>
                        <p class="text-sm text-muted-foreground text-center">Click to upload image</p>
                        <p class="text-xs text-muted-foreground mt-1">Street camera or citizen report</p>
                    </div>
                    <div id="upload-preview" class="hidden w-full h-full flex flex-col items-center">
                        <img id="preview-img" class="max-h-[120px] rounded mb-2 object-cover" />
                        <p class="text-xs text-green-600 font-semibold animate-pulse">Processing...</p>
                    </div>
                      <form method="post" enctype="multipart/form-data">
                          {% csrf_token %}
                        <input type="file" name="img" id="file-input" accept="image/*" class="absolute inset-0 cursor-pointer opacity-0" style="z-index: 10;">
                      </form>
                  </div>
                </div>
              </div>
            </div>

            <div class="lg:col-span-5 flex flex-col gap-4 lg:gap-6">

              <div class="panel h-full bg-card text-card-foreground rounded-lg border shadow-sm">
                <div class="panel-header p-6 pb-2">
                  <h2 class="text-sm font-semibold">AI Inspection Output</h2>
                </div>
                <div class="panel-content flex items-start justify-center p-6 pt-0 min-h-[12rem]" id="ai-output-container">

                  <div id="ai-placeholder" class="text-center text-muted-foreground self-center">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-brain mx-auto h-10 w-10 mb-3 opacity-40">
                      <path d="M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z"></path>
                      <path d="M12 5a3 3 0 1 1 5.997.125 4 4 0 0 1 2.526 5.77 4 4 0 0 1-.556 6.588A4 4 0 1 1 12 18Z"></path>
                      <path d="M15 13a4.5 4.5 0 0 1-3-4 4.5 4.5 0 0 1-3 4"></path>
                    </svg>
                    <p class="text-sm">Upload an image to begin AI inspection</p>
                  </div>

                  <div id="ai-result" class="hidden w-full">
                    <div class="space-y-4">
                        <div class="flex items-center justify-between rounded-md border p-3">
                            <span class="text-sm font-medium">Waste Detected</span>
                            <div class="flex items-center gap-2 text-severity-high">
                                <span class="text-sm font-semibold">YES</span>
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-circle-check h-5 w-5"><circle cx="12" cy="12" r="10"></circle><path d="m9 12 2 2 4-4"></path></svg>
                            </div>
                        </div>

                        <div class="rounded-md border p-3">
                            <p class="text-xs uppercase tracking-wider text-muted-foreground mb-1">Waste Category</p>
                            <p class="text-sm font-semibold">Plastic / Recyclables</p>
                        </div>

                        <div class="rounded-md border p-3">
                            <p class="text-xs uppercase tracking-wider text-muted-foreground mb-2">Severity Assessment</p>
                            <div class="flex items-center gap-4">
                                <span class="text-2xl font-bold tabular-nums">8.1</span>
                                <span class="rounded px-2 py-1 text-xs font-semibold bg-red-100 text-red-800 border border-red-200">HIGH</span>
                            </div>
                            <div aria-valuemax="100" aria-valuemin="0" role="progressbar" data-state="indeterminate" data-max="100" class="relative w-full overflow-hidden rounded-full bg-secondary mt-2 h-2 [&amp;&gt;div]:bg-severity-high">
                                <div data-state="indeterminate" data-max="100" class="h-full w-full flex-1 bg-primary transition-all bg-severity-high" style="transform: translateX(-19%); width: 81%;"></div>
                            </div>
                        </div>

                        <div class="rounded-md border border-primary/20 bg-primary/5 p-3">
                            <div class="flex items-start gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-arrow-right h-4 w-4 text-primary mt-0.5 shrink-0"><path d="M5 12h14"></path><path d="m12 5 7 7-7 7"></path></svg>
                                <div>
                                    <p class="text-xs uppercase tracking-wider text-muted-foreground mb-1">Recommended Action</p>
                                    <p class="text-sm font-medium text-primary">Immediate dispatch - public health concern</p>
                                </div>
                            </div>
                        </div>

                        <div class="flex items-center justify-between rounded-md border p-3 bg-muted/30">
                            <span class="text-xs uppercase tracking-wider text-muted-foreground">Model Confidence</span>
                            <div class="flex items-center gap-2">
                                <div aria-valuemax="100" aria-valuemin="0" role="progressbar" data-state="indeterminate" data-max="100" class="relative overflow-hidden rounded-full bg-secondary w-24 h-2">
                                    <div data-state="indeterminate" data-max="100" class="h-full w-full flex-1 bg-confidence transition-all" style="width: 86%;"></div>
                                </div>
                                <span class="text-sm font-mono font-medium">86.2%</span>
                            </div>
                        </div>
                    </div>
                  </div>

                </div>
              </div>

              <div class="panel bg-card text-card-foreground rounded-lg border shadow-sm">
                <div class="panel-header flex items-center justify-between p-6 pb-2">
                  <h2 class="text-sm font-semibold">Incident Status Tracker</h2>
                  <span class="text-xs text-muted-foreground">6 open / 8 total</span>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full caption-bottom text-sm">
                      <thead class="[&amp;_tr]:border-b">
                        <tr class="border-b transition-colors hover:bg-transparent">
                          <th class="h-12 px-4 text-left align-middle text-muted-foreground text-xs font-semibold uppercase w-[100px]">Ticket ID</th>
                          <th class="h-12 px-4 text-left align-middle text-muted-foreground text-xs font-semibold uppercase">Location</th>
                          <th class="h-12 px-4 text-left align-middle text-muted-foreground text-xs font-semibold uppercase">Time</th>
                          <th class="h-12 px-4 text-right align-middle text-muted-foreground text-xs font-semibold uppercase">Status</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr class="border-b transition-colors hover:bg-muted/50">
                          <td class="p-4 align-middle font-mono text-sm font-medium">INC-2024-001</td>
                          <td class="p-4 align-middle text-xs text-muted-foreground">40.7128, -74.0060</td>
                          <td class="p-4 align-middle text-sm">2 hrs ago</td>
                          <td class="p-4 align-middle text-right"><div class="inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80">OPEN</div></td>
                        </tr>
                        <tr class="border-b transition-colors hover:bg-muted/50">
                          <td class="p-4 align-middle font-mono text-sm font-medium">INC-2024-002</td>
                          <td class="p-4 align-middle text-xs text-muted-foreground">40.7282, -73.9942</td>
                          <td class="p-4 align-middle text-sm">5 hrs ago</td>
                          <td class="p-4 align-middle text-right"><div class="inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80">OPEN</div></td>
                        </tr>
                        <tr class="border-b transition-colors hover:bg-muted/50">
                          <td class="p-4 align-middle font-mono text-sm font-medium">INC-2024-003</td>
                          <td class="p-4 align-middle text-xs text-muted-foreground">40.7061, -74.0087</td>
                          <td class="p-4 align-middle text-sm">1 day ago</td>
                          <td class="p-4 align-middle text-right"><div class="inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80">URGENT</div></td>
                        </tr>
                         <tr class="border-b transition-colors hover:bg-muted/50">
                          <td class="p-4 align-middle font-mono text-sm font-medium">INC-2024-004</td>
                          <td class="p-4 align-middle text-xs text-muted-foreground">40.7359, -73.9911</td>
                          <td class="p-4 align-middle text-sm">2 days ago</td>
                          <td class="p-4 align-middle text-right"><div class="inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 text-foreground">RESOLVED</div></td>
                        </tr>
                      </tbody>
                    </table>
                </div>
              </div>
            </div>

            <div class="lg:col-span-4 flex flex-col gap-4 lg:gap-6">

              <div class="flex-1 min-h-[350px]">
                <div class="panel h-full flex flex-col bg-card text-card-foreground rounded-lg border shadow-sm">
                  <div class="panel-header flex items-center justify-between p-6 pb-2">
                    <div>
                      <h2 class="text-sm font-semibold">Incident Map</h2>
                      <p class="text-xs text-muted-foreground mt-0.5">For Field Operations</p>
                    </div>
                  </div>
                  <div class="flex-1 p-2 relative">
                    <div id="incident-map" class="map-container"></div>
                  </div>
                </div>
              </div>

              <div class="flex-1 min-h-[350px]">
                <div class="panel h-full flex flex-col bg-card text-card-foreground rounded-lg border shadow-sm">
                  <div class="panel-header flex items-center justify-between p-6 pb-2">
                    <div>
                      <h2 class="text-sm font-semibold">Waste Intensity Heatmap</h2>
                      <p class="text-xs text-muted-foreground mt-0.5">For Policy &amp; Planning</p>
                    </div>
                  </div>
                  <div class="flex-1 p-2 relative">
                    <div id="heatmap-map" class="map-container"></div>
                  </div>
                </div>
              </div>

            </div>
          </div>
        </div>

        <footer class="border-t border-border bg-card px-6 py-3">
          <div class="flex items-center justify-between text-xs text-muted-foreground">
            <span>Municipal Waste Monitoring System v2.4.1</span>
            <span>Data refresh: Real-time (Local Mode)</span>
          </div>
        </footer>
      </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

    <script>
      document.addEventListener('DOMContentLoaded', () => {
          // 1. Set Date
          const dateEl = document.getElementById('current-time');
          const now = new Date();
          dateEl.innerText = now.toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' }) + " at " + now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});

          // 2. Initialize Maps
          // Incident Map
          const map1 = L.map('incident-map').setView([40.7128, -74.0060], 13);
          L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
            attribution: '&copy; OpenStreetMap &copy; CARTO'
          }).addTo(map1);

          L.circleMarker([40.7128, -74.0060], {color: 'red', radius: 8}).addTo(map1).bindPopup("High Severity Incident");
          L.circleMarker([40.7250, -74.0000], {color: 'orange', radius: 8}).addTo(map1).bindPopup("Medium Severity");

          // Heatmap
          const map2 = L.map('heatmap-map').setView([40.7128, -74.0060], 12);
          L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
            attribution: '&copy; OpenStreetMap &copy; CARTO'
          }).addTo(map2);

          // 3. File Upload Interaction
          const fileInput = document.getElementById('file-input');

          fileInput.addEventListener('change', () => {
            fileInput.parentElement.submit();
          });
      });
    </script>
  </body>
</html>